common --experimental_cc_shared_library
common --enable_bzlmod

## WARNINIG: tools/bazel overrides this coswitch reg setting:
try-import %workspace%/.config/coswitch_registry.bazelrc

try-import %workspace%/.config/toolchains.bazelrc
try-import .config/registries.bazelrc
common --config=ocamlopt.opt
#common --config=ocamlc.byte
#common --config=ocamlopt.byte
#common --config=ocamlc.opt

common --registry=https://raw.githubusercontent.com/obazl/registry/main/
common --registry=https://bcr.bazel.build

# macos link: prevent ld warning about mismatched sdk versions
common --macos_sdk_version=14.0

# # toolchain selection: vm (bytecode), sys (nativecode) E.g. to compile
# # with ocamlc.opt, pass --config=ocamlc.opt (sys to vm). this means:
# # cross-compile from sys platform (native code) to vm platform (bytecode).
# ## IMPORTANT: --host_platform sets buildhost; --platforms sets targethost
# # default platform is sys for both buildhost and targethost
# build:ocamlc.byte --host_platform=@ocaml//platforms/build:vm
# build:ocamlc.byte --platforms=@ocaml//platforms/target:vm

# build:ocamlc.opt --host_platform=@ocaml//platforms/build:sys
# build:ocamlc.opt --platforms=@ocaml//platforms/target:vm

# build:ocamlopt.byte --host_platform=@ocaml//platforms/build:vm
# build:ocamlopt.byte --platforms=@ocaml//platforms/target:sys

# build:ocamlopt.opt --host_platform=@ocaml//platforms/build:sys
# build:ocamlopt.opt --platforms=@ocaml//platforms/target:sys

try-import .config/user.bazelrc
